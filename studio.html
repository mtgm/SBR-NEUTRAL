// studio.html içindeki "KAYDET" butonu eventi:

document.getElementById('save-config-btn').addEventListener('click', async () => {
    // currentTextureName değişkeni, dosya seçtiğinde "mese.jpg" gibi doluyor olmalı.
    if(!currentTextureName) {
        alert("Bir texture dosyası seçmedin!");
        return;
    }
    
    const url = new URL(location.href);
    const sku = url.searchParams.get('sku') || 'SBRV2';

    // 1. Yazma izni al
    const res = await fetch(`/api/engine?sku=${sku}&type=write`);
    const data = await res.json();
    
    if(data.ok) {
        // 2. Sadece dosya ismini kaydediyoruz (Örn: mese.jpg)
        // DİKKAT: 'mese.jpg' dosyasını R2'daki 'textures' klasörüne elle yüklemiş olmalısın!
        const configData = {
            sku: sku,
            textureName: currentTextureName, // Sadece isim
            updatedAt: new Date().toISOString()
        };

        // 3. R2'ya JSON'ı yükle
        await fetch(data.url, {
            method: 'PUT',
            body: JSON.stringify(configData),
            headers: { 'Content-Type': 'application/json' }
        });
        
        alert("✅ KAYDEDİLDİ! Müşteriler artık bu kaplamayı görecek.");
    } else {
        alert("Hata: " + data.error);
    }
});